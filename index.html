<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Keuangan</title>
<style>
/* ===== General ===== */
body { font-family: Arial,sans-serif; margin:0; padding:0; background:#f9f9f9; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background:#2196F3; color:white; position:relative; }
.logo { font-size:1.2em; font-weight:bold; }
.menu-toggle { font-size:1.5em; cursor:pointer; display:block; }
nav { display:none; flex-direction:column; background:#1976D2; position:absolute; top:50px; right:0; width:200px; border-radius:5px; overflow:hidden; z-index:1000; }
nav.show { display:flex; animation:fadeIn 0.3s forwards; }
nav a { padding:10px; color:white; text-decoration:none; border-bottom:1px solid rgba(255,255,255,0.2); }
nav a:hover { background:rgba(255,255,255,0.2); }
@keyframes fadeIn { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }

main { padding:20px; max-width:800px; margin:0 auto; }
section { margin-bottom:40px; }
h2 { color:#333; }

/* Summary Cards */
.summary-cards { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
.card { flex:1; min-width:150px; background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; font-weight:bold; }

/* Button Buat Catatan */
#showFormBtn { display:block; margin:20px auto; padding:15px 30px; font-size:1.2em; border-radius:10px; background:#4CAF50; color:#fff; border:none; cursor:pointer; transition:0.3s; }
#showFormBtn:hover { background:#45A049; }

/* Modal Pop-up Form */
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
.modal-content { background:#fff; padding:20px; border-radius:10px; width:90%; max-width:400px; position:relative; animation:slideDown 0.3s forwards; }
@keyframes slideDown { from { transform:translateY(-30px); opacity:0; } to { transform:translateY(0); opacity:1; } }
.closeBtn { position:absolute; top:10px; right:15px; font-size:1.5em; cursor:pointer; }
form { display:flex; flex-direction:column; gap:10px; }
form input, form select { padding:10px; border-radius:5px; border:1px solid #ccc; font-size:1em; }
form button { padding:12px; border:none; border-radius:5px; background:#2196F3; color:white; font-size:1em; cursor:pointer; transition:background 0.3s; }
form button:hover { background:#1976D2; }

/* Filter */
#filterContainer { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
#filterContainer input, #filterContainer button, #filterContainer select { padding:8px; border-radius:5px; border:1px solid #ccc; }
#filterContainer button { background:#2196F3; color:white; border:none; cursor:pointer; transition:0.3s; }
#filterContainer button:hover { background:#1976D2; }

/* Table */
table { width:100%; border-collapse:collapse; background:#fff; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
th, td { padding:10px; border:1px solid #ddd; text-align:left; }
th { background:#2196F3; color:white; }
td button { padding:5px 10px; margin-right:3px; cursor:pointer; font-size:0.9em; }

/* Export Pop-up */
#exportOptions.hidden { display:none; }
#exportOptions { display:flex; gap:10px; margin-top:5px; animation:fadeIn 0.3s forwards; }

/* Canvas Grafik */
canvas { margin-top:20px; max-width:100%; height:300px; }

/* Responsive */
@media (max-width:600px) {
  .summary-cards { flex-direction:column; }
  nav { width:100%; top:50px; right:0; }
  #filterContainer { flex-direction:column; }
}
</style>
</head>
<body>

<header>
  <div class="logo">Keuangan</div>
  <div class="menu-toggle" id="menuToggle">‚ò∞</div>
  <nav id="navMenu">
    <a href="#home">Home</a>
    <a href="#catatan">History</a>
    <a href="#grafik">Grafik</a>
  </nav>
</header>

<main>
  <!-- Home -->
  <section id="home">
    <div class="summary-cards">
      <div class="card" id="card-saldo">Saldo: Rp 0 <span id="toggleSaldo" style="cursor:pointer;">üëÅÔ∏è</span></div>
      <div class="card" id="card-pemasukan">Pemasukan: Rp 0</div>
      <div class="card" id="card-pengeluaran">Pengeluaran: Rp 0</div>
    </div>

    <button id="showFormBtn">Buat Catatan</button>

    <div id="formModal" class="modal">
      <div class="modal-content">
        <span class="closeBtn">&times;</span>
        <form id="transactionForm">
          <input type="date" id="transactionDate" required />
          <select id="type" required>
            <option value="">Pilih Jenis</option>
            <option value="Pemasukan">Pemasukan</option>
            <option value="Pengeluaran">Pengeluaran</option>
          </select>
          <input type="number" id="amount" placeholder="Jumlah" required />
          <input type="text" id="note" placeholder="Keterangan" />
          <input type="text" id="deskripsi" placeholder="Deskripsi (opsional)" />
          <input type="text" id="sumberDana" placeholder="Sumber Dana" />
          <select id="transactionAnggota" required></select>
          <input type="text" id="newAnggota" placeholder="Tambah anggota baru" />
          <button type="submit">Simpan Catatan</button>
        </form>
      </div>
    </div>
  </section>

  <!-- History -->
  <section id="catatan" style="display:none;">
    <h2>History Transaksi</h2>
    <div id="filterContainer">
      <input type="text" id="searchNote" placeholder="Cari keterangan..." />
      <input type="date" id="startDate" />
      <span>s/d</span>
      <input type="date" id="endDate" />
      <select id="filterAnggota"><option value="">Semua Anggota</option></select>
      <input type="text" id="filterSumberDana" placeholder="Sumber Dana" />
      <select id="filterType">
        <option value="">Semua Jenis</option>
        <option value="Pemasukan">Pemasukan</option>
        <option value="Pengeluaran">Pengeluaran</option>
      </select>
      <button id="applyFilter">Terapkan Filter</button>
    </div>
    <table id="transactionsTable">
      <thead>
        <tr>
          <th><input type="checkbox" id="checkAll"></th>
          <th>No</th>
          <th>Tanggal</th>
          <th>Jenis</th>
          <th>Jumlah</th>
          <th>Keterangan</th>
          <th>Deskripsi</th>
          <th>Sumber Dana</th>
          <th>Anggota</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="deleteSelected" style="display:none;">Hapus Terpilih</button>
    <button id="exportBtn">Export</button>
    <div id="exportOptions" class="hidden">
      <button data-type="csv">CSV</button>
      <button data-type="xlsx">XLSX</button>
      <button data-type="pdf">PDF</button>
    </div>
  </section>

  <!-- Grafik -->
  <section id="grafik" style="display:none;">
    <h2>Grafik Transaksi</h2>
    <canvas id="transactionChart"></canvas>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ===== Data & DOM =====
let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
let anggota = JSON.parse(localStorage.getItem('anggota')) || [];
let editingIndex = null;

const formModal = document.getElementById('formModal');
const showFormBtn = document.getElementById('showFormBtn');
const closeBtn = document.querySelector('.closeBtn');
const form = document.getElementById('transactionForm');
const transactionAnggota = document.getElementById('transactionAnggota');
const newAnggotaInput = document.getElementById('newAnggota');
const transactionsTableBody = document.querySelector('#transactionsTable tbody');
const deleteSelectedBtn = document.getElementById('deleteSelected');
const checkAll = document.getElementById('checkAll');
const filterAnggota = document.getElementById('filterAnggota');
const applyFilterBtn = document.getElementById('applyFilter');
const exportBtn = document.getElementById('exportBtn');
const exportOptions = document.getElementById('exportOptions');
const toggleSaldo = document.getElementById('toggleSaldo');
const saldoCard = document.getElementById('card-saldo');
const pemasukanCard = document.getElementById('card-pemasukan');
const pengeluaranCard = document.getElementById('card-pengeluaran');
const menuToggle = document.getElementById('menuToggle');
const navMenu = document.getElementById('navMenu');

let saldoVisible = true;

// ===== Functions =====
function renderAnggotaDropdown(){
  transactionAnggota.innerHTML = '<option value="">Pilih Anggota</option>';
  anggota.forEach(a=>{
    const opt = document.createElement('option'); opt.value=a; opt.textContent=a;
    transactionAnggota.appendChild(opt);
  });
  filterAnggota.innerHTML = '<option value="">Semua Anggota</option>';
  anggota.forEach(a=>{
    const opt = document.createElement('option'); opt.value=a; opt.textContent=a;
    filterAnggota.appendChild(opt);
  });
}

function calculateSaldo(){
  let pemasukan = transactions.filter(t=>t.type==='Pemasukan').reduce((a,b)=>a+Number(b.amount),0);
  let pengeluaran = transactions.filter(t=>t.type==='Pengeluaran').reduce((a,b)=>a+Number(b.amount),0);
  return pemasukan - pengeluaran;
}

function updateSummary(){
  const pemasukan = transactions.filter(t=>t.type==='Pemasukan').reduce((a,b)=>a+Number(b.amount),0);
  const pengeluaran = transactions.filter(t=>t.type==='Pengeluaran').reduce((a,b)=>a+Number(b.amount),0);
  saldoCard.textContent = saldoVisible ? `Saldo: Rp ${calculateSaldo()}` : 'Saldo: ****';
  saldoCard.appendChild(toggleSaldo);
  pemasukanCard.textContent = `Pemasukan: Rp ${pemasukan}`;
  pengeluaranCard.textContent = `Pengeluaran: Rp ${pengeluaran}`;
}

function renderTransactionsTable(){
  transactionsTableBody.innerHTML = '';
  const typeFilterVal = document.getElementById('filterType').value;
  const anggotaFilterVal = filterAnggota.value;
  const searchNoteVal = document.getElementById('searchNote').value.toLowerCase();

  transactions.forEach((t,i)=>{
    if(typeFilterVal && t.type!==typeFilterVal) return;
    if(anggotaFilterVal && t.anggota!==anggotaFilterVal) return;
    if(searchNoteVal && !t.note.toLowerCase().includes(searchNoteVal)) return;

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="checkbox" class="rowCheckbox" data-index="${i}"></td>
      <td>${i+1}</td>
      <td>${t.date}</td>
      <td>${t.type}</td>
      <td>Rp ${t.amount}</td>
      <td>${t.note}</td>
      <td>${t.deskripsi}</td>
      <td>${t.sumberDana}</td>
      <td>${t.anggota}</td>
      <td>
        <button class="editBtn">‚úé</button>
        <button class="statusBtn">Status</button>
      </td>
    `;
    transactionsTableBody.appendChild(tr);

    tr.querySelector('.editBtn').addEventListener('click', ()=>{
      editingIndex = i;
      formModal.style.display='flex';
      document.getElementById('type').value = t.type;
      document.getElementById('amount').value = t.amount;
      document.getElementById('note').value = t.note;
      document.getElementById('transactionDate').value = t.date;
      document.getElementById('deskripsi').value = t.deskripsi;
      document.getElementById('sumberDana').value = t.sumberDana;
      transactionAnggota.value = t.anggota;
      newAnggotaInput.value='';
    });
  });

  const rowCheckboxes = document.querySelectorAll('.rowCheckbox');
  rowCheckboxes.forEach(cb=>{
    cb.addEventListener('change', ()=>{
      deleteSelectedBtn.style.display = document.querySelectorAll('.rowCheckbox:checked').length>0 ? 'inline-block':'none';
    });
  });
}

// ===== Event Listeners =====
menuToggle.addEventListener('click', ()=> navMenu.classList.toggle('show'));
toggleSaldo.addEventListener('click', ()=>{
  saldoVisible = !saldoVisible;
  updateSummary();
});

showFormBtn.addEventListener('click', ()=> formModal.style.display='flex');
closeBtn.addEventListener('click', ()=> formModal.style.display='none');
window.addEventListener('click', e=> { if(e.target===formModal) formModal.style.display='none'; });

document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];

form.addEventListener('submit', e=>{
  e.preventDefault();
  const type = document.getElementById('type').value;
  const amount = document.getElementById('amount').value;
  const note = document.getElementById('note').value;
  const date = document.getElementById('transactionDate').value;
  const deskripsi = document.getElementById('deskripsi').value;
  const sumberDana = document.getElementById('sumberDana').value;
  let anggotaVal = transactionAnggota.value;
  const newAnggotaVal = newAnggotaInput.value.trim();

  if(newAnggotaVal && !anggota.includes(newAnggotaVal)){
    anggota.push(newAnggotaVal);
    localStorage.setItem('anggota', JSON.stringify(anggota));
    renderAnggotaDropdown();
    anggotaVal = newAnggotaVal;
  }

  const transaction = {type, amount, note, date, deskripsi, sumberDana, anggota: anggotaVal};
  if(editingIndex!==null){
    transactions[editingIndex] = transaction;
    editingIndex = null;
  } else transactions.push(transaction);

  localStorage.setItem('transactions', JSON.stringify(transactions));
  form.reset();
  document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
  renderTransactionsTable();
  updateSummary();
  formModal.style.display='none';
});

deleteSelectedBtn.addEventListener('click', ()=>{
  const checkedIndexes = Array.from(document.querySelectorAll('.rowCheckbox:checked')).map(cb=>parseInt(cb.dataset.index));
  transactions = transactions.filter((_,i)=>!checkedIndexes.includes(i));
  localStorage.setItem('transactions', JSON.stringify(transactions));
  renderTransactionsTable();
  updateSummary();
  deleteSelectedBtn.style.display='none';
  checkAll.checked=false;
});

applyFilterBtn.addEventListener('click', e=>{ e.preventDefault(); renderTransactionsTable(); });

exportBtn.addEventListener('click', ()=> exportOptions.classList.toggle('hidden'));
exportOptions.querySelectorAll('button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const type = btn.dataset.type;
    let csv = 'Tanggal,Jenis,Jumlah,Keterangan,Deskripsi,SumberDana,Anggota\n';
    transactions.forEach(t=>{
      csv += `${t.date},${t.type},${t.amount},${t.note},${t.deskripsi},${t.sumberDana},${t.anggota}\n`;
    });
    const blob = new Blob([csv], {type:'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download=`transaksi.${type}`; a.click();
    URL.revokeObjectURL(url);
    exportOptions.classList.add('hidden');
  });
});

// Section switching
const navLinks = document.querySelectorAll('nav a');
const sections = document.querySelectorAll('main section');
navLinks.forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    const target = document.querySelector(link.getAttribute('href'));
    sections.forEach(sec=>sec.style.display='none');
    target.style.display='block';
  });
});

// Chart.js
const ctx = document.getElementById('transactionChart').getContext('2d');
let chart;
function updateChart(){
  const pemasukan = transactions.filter(t=>t.type==='Pemasukan').reduce((a,b)=>a+Number(b.amount),0);
  const pengeluaran = transactions.filter(t=>t.type==='Pengeluaran').reduce((a,b)=>a+Number(b.amount),0);
  const data = { labels:['Pemasukan','Pengeluaran'], datasets:[{label:'Jumlah (Rp)', data:[pemasukan,pengeluaran], backgroundColor:['#4CAF50','#F44336']}] };
  if(chart) chart.destroy();
  chart = new Chart(ctx, { type:'bar', data:data, options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false}, title:{display:true, text:'Grafik Transaksi'} } } });
}

// ===== Init =====
renderAnggotaDropdown();
renderTransactionsTable();
updateSummary();
updateChart();
</script>
</body>
</html>
